<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PropDecoded - Professional Property Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .backdrop-blur-xl {
            backdrop-filter: blur(24px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen">
    
    <!-- PHASE 1: Property Profile -->
    <div id="phase1" class="p-6">
        <div class="max-w-6xl mx-auto">
            <!-- Header Bar -->
            <div class="bg-black bg-opacity-40 backdrop-blur-xl border border-blue-500/30 rounded-2xl p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="bg-blue-500 p-3 rounded-xl">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold text-white tracking-tight">PropDecoded</h1>
                            <p class="text-blue-300 text-sm">Professional Property Analytics Platform</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 px-4 py-2 bg-blue-500/20 rounded-lg border border-blue-400/30">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span class="text-blue-200 text-sm font-medium">LIVE SYSTEM</span>
                    </div>
                </div>
            </div>

            <!-- Main Card -->
            <div class="bg-black bg-opacity-40 backdrop-blur-xl border border-blue-500/30 rounded-2xl overflow-hidden">
                <div class="bg-gradient-to-r from-blue-600/20 to-purple-600/20 border-b border-blue-500/30 p-4">
                    <div class="flex items-center gap-3">
                        <div class="flex items-center gap-2 px-3 py-1 bg-blue-500/30 rounded-full">
                            <div class="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs font-bold">1</div>
                            <span class="text-blue-200 text-sm font-semibold">PHASE 1</span>
                        </div>
                        <div class="h-px flex-1 bg-gradient-to-r from-blue-500/50 to-transparent"></div>
                        <span class="text-blue-300 text-sm">Property Profile Configuration</span>
                    </div>
                </div>

                <div class="p-8">
                    <!-- Critical Alert -->
                    <div class="mb-8 bg-gradient-to-r from-yellow-900/30 to-orange-900/30 border-l-4 border-yellow-500 rounded-lg p-6">
                        <div class="flex items-start gap-4">
                            <div class="bg-yellow-500/20 p-2 rounded-lg">
                                <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-yellow-300 font-bold text-lg mb-2">CRITICAL: Tax Calculation Parameters</h3>
                                <p class="text-yellow-100/80 text-sm leading-relaxed">
                                    Enter fixed property parameters. Acquisition date is critical for accurate tax cliff calculations.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Form -->
                    <div class="space-y-6">
                        <!-- Acquisition Date -->
                        <div class="bg-gradient-to-br from-red-900/20 to-orange-900/20 border-2 border-orange-500/50 rounded-xl p-6 shadow-xl">
                            <label class="flex items-center gap-3 text-orange-300 font-bold text-sm mb-4 uppercase tracking-wide">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                Acquisition Date ‚Äî TAX CALCULATION BASIS
                            </label>
                            <input
                                type="date"
                                id="acquisitionDate"
                                class="w-full px-6 py-4 bg-black/40 border-2 border-orange-500/50 rounded-xl text-white text-lg font-mono focus:ring-4 focus:ring-orange-500/50 focus:border-orange-400 transition-all"
                                style="color-scheme: dark;"
                                required
                            />
                            <p class="text-orange-300/60 text-xs mt-2">Used to calculate holding period for SBT exemption</p>
                        </div>

                        <!-- Grid: Appraisal + Residence -->
                        <div class="grid grid-cols-2 gap-6">
                            <div class="bg-slate-800/40 border border-blue-500/30 rounded-xl p-6">
                                <label class="text-blue-300 font-semibold text-sm mb-3 block">Appraisal Price (THB)</label>
                                <input
                                    type="number"
                                    id="appraisalPrice"
                                    value="5000000"
                                    class="w-full px-4 py-3 bg-black/40 border border-blue-400/30 rounded-lg text-white text-xl font-mono focus:ring-2 focus:ring-blue-500 transition-all"
                                />
                                <p class="text-blue-300/50 text-xs mt-2">Tax base calculation reference</p>
                            </div>

                            <div class="bg-slate-800/40 border border-blue-500/30 rounded-xl p-6">
                                <label class="text-blue-300 font-semibold text-sm mb-3 block">Residence Status</label>
                                <div class="space-y-3">
                                    <label class="flex items-center gap-3 cursor-pointer">
                                        <input type="checkbox" id="isPrimaryResidence" class="w-5 h-5 text-blue-600 rounded">
                                        <span class="text-blue-100 text-sm">Primary Residence</span>
                                    </label>
                                    <label class="flex items-center gap-3 cursor-pointer">
                                        <input type="checkbox" id="hasHouseRegistration" class="w-5 h-5 text-blue-600 rounded">
                                        <span class="text-blue-100 text-sm">House Registration</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Costs -->
                        <div class="bg-slate-800/40 border border-blue-500/30 rounded-xl p-6">
                            <h3 class="text-blue-300 font-bold text-sm mb-4 uppercase tracking-wide">Monthly Holding Costs</h3>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="text-blue-200/70 text-xs mb-2 block">Common Area Fee</label>
                                    <input type="number" id="commonFee" value="3000" class="w-full px-4 py-3 bg-black/40 border border-blue-400/30 rounded-lg text-white font-mono focus:ring-2 focus:ring-blue-500 transition-all"/>
                                </div>
                                <div>
                                    <label class="text-blue-200/70 text-xs mb-2 block">Interest Payment</label>
                                    <input type="number" id="monthlyInterest" value="8000" class="w-full px-4 py-3 bg-black/40 border border-blue-400/30 rounded-lg text-white font-mono focus:ring-2 focus:ring-blue-500 transition-all"/>
                                </div>
                                <div>
                                    <label class="text-blue-200/70 text-xs mb-2 block">Special Levy (Est.)</label>
                                    <input type="number" id="specialLevyExpected" value="500" class="w-full px-4 py-3 bg-black/40 border border-blue-400/30 rounded-lg text-white font-mono focus:ring-2 focus:ring-blue-500 transition-all"/>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-blue-900/20 rounded-lg border border-blue-500/30">
                                <div class="flex justify-between items-center">
                                    <span class="text-blue-300 text-sm font-semibold">Total Monthly Cost:</span>
                                    <span id="totalMonthlyCost" class="text-blue-100 text-xl font-bold font-mono">11,500 THB</span>
                                </div>
                            </div>
                        </div>

                        <!-- Opportunity Cost -->
                        <div class="bg-slate-800/40 border border-blue-500/30 rounded-xl p-6">
                            <h3 class="text-blue-300 font-bold text-sm mb-4 uppercase tracking-wide">Opportunity Cost Analysis</h3>
                            <label class="flex items-center gap-3 cursor-pointer mb-4">
                                <input type="checkbox" id="isVacant" checked class="w-5 h-5 text-blue-600 rounded">
                                <span class="text-blue-100">Unit Currently Vacant</span>
                            </label>
                            <div id="rentSection">
                                <label class="text-blue-200/70 text-xs mb-2 block">Expected Monthly Rent (THB)</label>
                                <input type="number" id="expectedRent" value="15000" class="w-full px-4 py-3 bg-black/40 border border-blue-400/30 rounded-lg text-white text-lg font-mono focus:ring-2 focus:ring-blue-500 transition-all"/>
                                <p class="text-blue-300/50 text-xs mt-2">Net opportunity cost: <span id="netOppCost">10,500</span> THB/month (after 30% expenses)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Next Button -->
                    <button
                        id="proceedBtn"
                        type="button"
                        class="w-full mt-8 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white py-5 rounded-xl font-bold text-lg transition-all shadow-2xl hover:shadow-blue-500/50 flex items-center justify-center gap-3 cursor-pointer"
                        style="cursor: pointer; pointer-events: auto;"
                    >
                        <span>PROCEED TO SCENARIO ANALYSIS</span>
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PHASE 2: Scenario Simulator -->
    <div id="phase2" style="display:none;" class="p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="bg-black bg-opacity-40 backdrop-blur-xl border border-purple-500/30 rounded-2xl p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="bg-gradient-to-br from-purple-500 to-pink-500 p-3 rounded-xl">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold text-white tracking-tight">Scenario Simulator</h1>
                            <p class="text-purple-300 text-sm">3-Scenario Decision Analysis Engine</p>
                        </div>
                    </div>
                    <button
                        id="backBtn"
                        type="button"
                        class="px-6 py-3 bg-slate-700/50 hover:bg-slate-600/50 text-white rounded-xl transition-all border border-slate-500/50 cursor-pointer"
                        style="cursor: pointer; pointer-events: auto;"
                    >
                        ‚Üê Edit Profile
                    </button>
                </div>
            </div>

            <!-- Scenario Input Cards -->
            <div class="grid grid-cols-3 gap-6 mb-8">
                <!-- Best Case -->
                <div class="bg-black/40 backdrop-blur-xl border-2 border-emerald-500/50 rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="text-3xl">üéØ</span>
                        <div>
                            <h3 class="text-emerald-400 font-bold text-sm uppercase tracking-wider">BEST CASE</h3>
                            <p class="text-emerald-300/60 text-xs">Scenario Optimistic</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="text-gray-400 text-xs mb-2 block uppercase">Sale Price (THB)</label>
                            <input type="number" id="bestPrice" value="6000000" class="w-full px-4 py-3 bg-slate-900/50 border border-emerald-500/30 rounded-xl text-white text-lg font-mono focus:ring-2 focus:ring-emerald-500"/>
                        </div>
                        <div>
                            <label class="text-gray-400 text-xs mb-2 block uppercase">Wait Period (Months)</label>
                            <input type="number" id="bestWait" value="3" class="w-full px-4 py-3 bg-slate-900/50 border border-emerald-500/30 rounded-xl text-white text-lg font-mono focus:ring-2 focus:ring-emerald-500"/>
                        </div>
                    </div>
                </div>

                <!-- Base Case -->
                <div class="bg-black/40 backdrop-blur-xl border-2 border-blue-500/50 rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="text-3xl">üìä</span>
                        <div>
                            <h3 class="text-blue-400 font-bold text-sm uppercase tracking-wider">BASE CASE</h3>
                            <p class="text-blue-300/60 text-xs">Scenario Realistic</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="text-gray-400 text-xs mb-2 block uppercase">Sale Price (THB)</label>
                            <input type="number" id="basePrice" value="5500000" class="w-full px-4 py-3 bg-slate-900/50 border border-blue-500/30 rounded-xl text-white text-lg font-mono focus:ring-2 focus:ring-blue-500"/>
                        </div>
                        <div>
                            <label class="text-gray-400 text-xs mb-2 block uppercase">Wait Period (Months)</label>
                            <input type="number" id="baseWait" value="6" class="w-full px-4 py-3 bg-slate-900/50 border border-blue-500/30 rounded-xl text-white text-lg font-mono focus:ring-2 focus:ring-blue-500"/>
                        </div>
                    </div>
                </div>

                <!-- Worst Case -->
                <div class="bg-black/40 backdrop-blur-xl border-2 border-rose-500/50 rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="text-3xl">‚ö†Ô∏è</span>
                        <div>
                            <h3 class="text-rose-400 font-bold text-sm uppercase tracking-wider">WORST CASE</h3>
                            <p class="text-rose-300/60 text-xs">Scenario Conservative</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="text-gray-400 text-xs mb-2 block uppercase">Sale Price (THB)</label>
                            <input type="number" id="worstPrice" value="5000000" class="w-full px-4 py-3 bg-slate-900/50 border border-rose-500/30 rounded-xl text-white text-lg font-mono focus:ring-2 focus:ring-rose-500"/>
                        </div>
                        <div>
                            <label class="text-gray-400 text-xs mb-2 block uppercase">Wait Period (Months)</label>
                            <input type="number" id="worstWait" value="12" class="w-full px-4 py-3 bg-slate-900/50 border border-rose-500/30 rounded-xl text-white text-lg font-mono focus:ring-2 focus:ring-rose-500"/>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calculate Button -->
            <button
                id="calculateBtn"
                type="button"
                class="w-full bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 hover:from-purple-500 hover:via-pink-500 hover:to-red-500 text-white py-6 rounded-2xl font-bold text-xl transition-all shadow-2xl flex items-center justify-center gap-4 mb-8 cursor-pointer"
                style="cursor: pointer; pointer-events: auto;"
            >
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                </svg>
                <span>RUN COMPREHENSIVE ANALYSIS</span>
                <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
            </button>

            <!-- Results Container -->
            <div id="results" style="display:none;"></div>
        </div>
    </div>

    <script>
        console.log('Script loaded');

        // Phase Management
        function goToPhase2() {
            console.log('goToPhase2 called');
            const acqDateInput = document.getElementById('acquisitionDate');
            const acqDate = acqDateInput.value;
            console.log('Acquisition date:', acqDate);
            console.log('Input element:', acqDateInput);
            
            if (!acqDate || acqDate === '') {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î (Acquisition Date)');
                acqDateInput.focus();
                return;
            }
            
            const phase1 = document.getElementById('phase1');
            const phase2 = document.getElementById('phase2');
            
            console.log('Phase1 element:', phase1);
            console.log('Phase2 element:', phase2);
            
            phase1.style.display = 'none';
            phase2.style.display = 'block';
            document.body.className = 'bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen';
            window.scrollTo(0, 0);
            
            console.log('Phase switched to 2');
        }

        function goToPhase1() {
            console.log('goToPhase1 called');
            document.getElementById('phase2').style.display = 'none';
            document.getElementById('phase1').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.body.className = 'bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen';
            window.scrollTo(0, 0);
        }

        // Update Total Monthly Cost
        function updateTotalCost() {
            const common = parseFloat(document.getElementById('commonFee').value) || 0;
            const interest = parseFloat(document.getElementById('monthlyInterest').value) || 0;
            const levy = parseFloat(document.getElementById('specialLevyExpected').value) || 0;
            const total = common + interest + levy;
            document.getElementById('totalMonthlyCost').textContent = total.toLocaleString() + ' THB';
        }

        // Update Net Opportunity Cost
        function updateOppCost() {
            const rent = parseFloat(document.getElementById('expectedRent').value) || 0;
            const net = rent * 0.7;
            document.getElementById('netOppCost').textContent = net.toLocaleString();
        }

        // Toggle Rent Section
        document.getElementById('isVacant').addEventListener('change', function() {
            document.getElementById('rentSection').style.display = this.checked ? 'block' : 'none';
        });

        // Event Listeners
        ['commonFee', 'monthlyInterest', 'specialLevyExpected'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateTotalCost);
        });
        document.getElementById('expectedRent').addEventListener('input', updateOppCost);

        // CALCULATION ENGINE
        function calculateHoldingYears(acqDate, saleDate) {
            const diff = saleDate - new Date(acqDate);
            return diff / (1000 * 60 * 60 * 24 * 365.25);
        }

        function calculateLandTaxRate(years) {
            if (years <= 3) return 0.003;
            return 0.003 + (Math.floor(years - 3) * 0.003);
        }

        function checkSBTExempt(holdingYears, isPrimary, hasReg) {
            if (isPrimary && hasReg && holdingYears >= 1) return true;
            if (holdingYears > 5) return true;
            return false;
        }

        function calculateScenario(name, salePrice, waitMonths) {
            const acqDate = document.getElementById('acquisitionDate').value;
            const appraisal = parseFloat(document.getElementById('appraisalPrice').value);
            const isPrimary = document.getElementById('isPrimaryResidence').checked;
            const hasReg = document.getElementById('hasHouseRegistration').checked;
            const commonFee = parseFloat(document.getElementById('commonFee').value);
            const interest = parseFloat(document.getElementById('monthlyInterest').value);
            const levy = parseFloat(document.getElementById('specialLevyExpected').value);
            const isVacant = document.getElementById('isVacant').checked;
            const rent = parseFloat(document.getElementById('expectedRent').value);

            const saleDate = new Date();
            saleDate.setMonth(saleDate.getMonth() + waitMonths);

            const holdingYears = calculateHoldingYears(acqDate, saleDate);
            const monthlyFixedCost = commonFee + interest + levy;
            const waitCost = waitMonths * monthlyFixedCost;

            const oppMonthlyCost = isVacant ? rent * 0.7 : 0;
            const oppCost = oppMonthlyCost * waitMonths;

            const landTaxRate = calculateLandTaxRate(holdingYears);
            const landTax = landTaxRate * appraisal;

            const taxBase = Math.max(salePrice, appraisal);
            const isSBTExempt = checkSBTExempt(holdingYears, isPrimary, hasReg);
            const transferTax = isSBTExempt ? 0.005 * taxBase : 0.033 * taxBase;
            const taxType = isSBTExempt ? 'Stamp 0.5%' : 'SBT 3.3%';

            const totalCosts = waitCost + oppCost + landTax + transferTax;
            const netCash = salePrice - totalCosts;
            const roi = ((netCash / salePrice) * 100).toFixed(2);

            return {
                name,
                salePrice,
                waitMonths,
                saleDate: saleDate.toLocaleDateString('th-TH'),
                holdingYears: holdingYears.toFixed(2),
                waitCost,
                oppCost,
                landTax,
                landTaxRate: (landTaxRate * 100).toFixed(2) + '%',
                transferTax,
                taxType,
                totalCosts,
                netCash,
                roi
            };
        }

        function runCalculation() {
            const best = calculateScenario('Best', 
                parseFloat(document.getElementById('bestPrice').value),
                parseInt(document.getElementById('bestWait').value)
            );
            const base = calculateScenario('Base',
                parseFloat(document.getElementById('basePrice').value),
                parseInt(document.getElementById('baseWait').value)
            );
            const worst = calculateScenario('Worst',
                parseFloat(document.getElementById('worstPrice').value),
                parseInt(document.getElementById('worstWait').value)
            );

            displayResults([best, base, worst]);
        }

        function displayResults(results) {
            const colors = [
                {border: 'border-emerald-500/50', bg: 'from-emerald-900/50 to-emerald-800/50', text: 'text-emerald-300', highlight: 'text-emerald-400', card: 'from-emerald-900/30 to-emerald-800/30', badge: 'bg-emerald-500/20 text-emerald-300', bar: 'from-emerald-600 to-emerald-400'},
                {border: 'border-blue-500/50', bg: 'from-blue-900/50 to-blue-800/50', text: 'text-blue-300', highlight: 'text-blue-400', card: 'from-blue-900/30 to-blue-800/30', badge: 'bg-blue-500/20 text-blue-300', bar: 'from-blue-600 to-blue-400'},
                {border: 'border-rose-500/50', bg: 'from-rose-900/50 to-rose-800/50', text: 'text-rose-300', highlight: 'text-rose-400', card: 'from-rose-900/30 to-rose-800/30', badge: 'bg-rose-500/20 text-rose-300', bar: 'from-rose-600 to-rose-400'}
            ];

            let html = '<div class="space-y-6 fade-in"><div class="grid grid-cols-3 gap-6">';

            results.forEach((r, i) => {
                const c = colors[i];
                html += `
                <div class="bg-black/40 backdrop-blur-xl border-2 ${c.border} rounded-2xl overflow-hidden">
                    <div class="bg-gradient-to-r ${c.bg} border-b ${c.border} p-4">
                        <h3 class="${c.text} font-bold text-lg uppercase tracking-wide">${r.name} CASE</h3>
                    </div>
                                            <div class="p-6 space-y-4">
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                                    <span class="text-gray-400">Sale Price:</span>
                                    <span class="text-white font-bold font-mono">${r.salePrice.toLocaleString()} ‡∏ø</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                                    <span class="text-gray-400">Wait Period:</span>
                                    <span class="text-white font-bold">${r.waitMonths} months</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                                    <span class="text-gray-400">Sale Date:</span>
                                    <span class="text-white font-mono text-xs">${r.saleDate}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                                    <span class="text-gray-400">Holding Period:</span>
                                    <span class="${c.highlight} font-bold">${r.holdingYears} years</span>
                                </div>
                            </div>
                            <div class="bg-slate-900/50 rounded-xl p-4 space-y-2 text-xs border border-slate-700/50">
                                <div class="text-gray-300 font-bold mb-3 uppercase tracking-wide">Cost Analysis</div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Holding Cost:</span>
                                    <span class="text-gray-200 font-mono">${r.waitCost.toLocaleString()} ‡∏ø</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Opportunity Cost:</span>
                                    <span class="text-gray-200 font-mono">${r.oppCost.toLocaleString()} ‡∏ø</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Land Tax (${r.landTaxRate}):</span>
                                    <span class="text-gray-200 font-mono">${r.landTax.toLocaleString()} ‡∏ø</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Transfer Tax (${r.taxType}):</span>
                                    <span class="text-gray-200 font-mono">${r.transferTax.toLocaleString()} ‡∏ø</span>
                                </div>
                                <div class="flex justify-between pt-2 mt-2 border-t border-slate-600 font-bold">
                                    <span class="text-gray-300">Total Costs:</span>
                                    <span class="text-red-400 font-mono">${r.totalCosts.toLocaleString()} ‡∏ø</span>
                                </div>
                            </div>
                            <div class="bg-gradient-to-br ${c.card} border-2 ${c.border} rounded-xl p-6 text-center">
                                <div class="text-gray-400 text-xs uppercase tracking-wide mb-2">Net Cash in Hand</div>
                                <div class="${c.highlight} text-3xl font-bold font-mono mb-2">${r.netCash.toLocaleString()}</div>
                                <div class="text-xs text-gray-400">THB</div>
                                <div class="mt-3 inline-block px-3 py-1 ${c.badge} rounded-full text-xs font-semibold">
                                    ROI: ${r.roi}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
            });

            html += '</div>';

            // Executive Recommendation
            const sorted = [...results].sort((a, b) => b.netCash - a.netCash);
            const best = sorted[0];
            const netDiff = (best.netCash - sorted[1].netCash).toLocaleString();
            
            let recommendation = '';
            if (best.name === 'Best') {
                recommendation = `‚úÖ OPTIMAL STRATEGY: Best Case scenario delivers maximum net cash of ${best.netCash.toLocaleString()} THB (${netDiff} THB advantage over Base Case). Wait period of ${best.waitMonths} months justifies the opportunity cost through higher sale price realization.`;
            } else if (best.name === 'Base') {
                recommendation = `‚öñÔ∏è BALANCED APPROACH: Base Case offers optimal risk-adjusted returns at ${best.netCash.toLocaleString()} THB. The ${best.waitMonths}-month timeline balances holding costs against price appreciation potential.`;
            } else {
                recommendation = `‚ö†Ô∏è RISK MITIGATION: Consider accelerated sale timeline. Extended holding periods show diminishing returns due to accumulated costs. Worst Case scenario may represent market reality requiring strategic reassessment.`;
            }

            html += `
            <div class="bg-black/40 backdrop-blur-xl border-2 border-purple-500/50 rounded-2xl p-8">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-gradient-to-br from-purple-500 to-pink-500 p-2 rounded-lg">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                        </svg>
                    </div>
                    <h3 class="text-purple-300 font-bold text-xl uppercase tracking-wide">Executive Recommendation</h3>
                </div>
                <div class="bg-gradient-to-r from-purple-900/30 to-pink-900/30 rounded-xl p-6 border border-purple-500/30">
                    <p class="text-gray-200 text-lg leading-relaxed">${recommendation}</p>
                </div>
                <div class="mt-6 grid grid-cols-3 gap-4">`;

            const maxNet = Math.max(...results.map(r => r.netCash));
            results.forEach((r, i) => {
                const c = colors[i];
                const percentage = (r.netCash / maxNet) * 100;
                html += `
                <div class="text-center">
                    <div class="text-gray-400 text-xs uppercase tracking-wide mb-2">${r.name}</div>
                    <div class="h-32 bg-slate-900/50 rounded-lg border border-slate-700/50 flex items-end justify-center p-2">
                        <div class="w-full bg-gradient-to-t ${c.bar} rounded transition-all duration-1000" style="height: ${percentage}%"></div>
                    </div>
                    <div class="${c.highlight} mt-2 font-bold font-mono text-sm">${r.netCash.toLocaleString()}</div>
                </div>`;
            });

            html += `
                </div>
            </div>
            <div class="bg-slate-900/50 border border-slate-700/50 rounded-xl p-6">
                <div class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-gray-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <div>
                        <h4 class="text-gray-400 font-semibold text-sm mb-2">LEGAL DISCLAIMER</h4>
                        <p class="text-gray-500 text-xs leading-relaxed">
                            This tool provides factual calculations based on current Thai tax regulations. Output is for informational purposes only and does not constitute financial, legal, or tax advice. Consult qualified professionals before making property transaction decisions. Tax laws are subject to change and individual circumstances may affect actual outcomes.
                        </p>
                    </div>
                </div>
            </div>
            </div>`;

            document.getElementById('results').innerHTML = html;
            document.getElementById('results').style.display = 'block';
        }

        // Initialize
        updateTotalCost();
        updateOppCost();

        // Event Listeners - using both methods for compatibility
        window.addEventListener('load', function() {
            console.log('Window loaded');
            
            const proceedBtn = document.getElementById('proceedBtn');
            const backBtn = document.getElementById('backBtn');
            const calculateBtn = document.getElementById('calculateBtn');
            
            console.log('Proceed button:', proceedBtn);
            console.log('Back button:', backBtn);
            console.log('Calculate button:', calculateBtn);
            
            if (proceedBtn) {
                proceedBtn.addEventListener('click', function(e) {
                    console.log('Proceed button clicked');
                    e.preventDefault();
                    goToPhase2();
                });
                console.log('Proceed listener attached');
            }
            
            if (backBtn) {
                backBtn.addEventListener('click', function(e) {
                    console.log('Back button clicked');
                    e.preventDefault();
                    goToPhase1();
                });
            }
            
            if (calculateBtn) {
                calculateBtn.addEventListener('click', function(e) {
                    console.log('Calculate button clicked');
                    e.preventDefault();
                    runCalculation();
                });
            }
        });
    </script>
</body>
</html>
